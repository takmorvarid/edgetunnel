const _0x585a6a=_0x1628;(function(_0x3d88ae,_0x458739){const _0x5d3ccf=_0x1628,_0x54a351=_0x3d88ae();while(!![]){try{const _0x12c53f=parseInt(_0x5d3ccf(0x188))/0x1*(parseInt(_0x5d3ccf(0x177))/0x2)+-parseInt(_0x5d3ccf(0x15a))/0x3+parseInt(_0x5d3ccf(0x180))/0x4+parseInt(_0x5d3ccf(0x172))/0x5+parseInt(_0x5d3ccf(0x154))/0x6+-parseInt(_0x5d3ccf(0x181))/0x7*(parseInt(_0x5d3ccf(0x16c))/0x8)+-parseInt(_0x5d3ccf(0x140))/0x9;if(_0x12c53f===_0x458739)break;else _0x54a351['push'](_0x54a351['shift']());}catch(_0x4070cc){_0x54a351['push'](_0x54a351['shift']());}}}(_0x3969,0xac3e2));import{connect}from'cloudflare:sockets';let userID=_0x585a6a(0x158),proxyIP=_0x585a6a(0x190);if(!isValidUUID(userID))throw new Error(_0x585a6a(0x152));export default{async 'fetch'(_0x5b4b7e,_0x2f5e2d,_0x41cfc4){const _0x2fd0f9=_0x585a6a;try{userID=_0x2f5e2d[_0x2fd0f9(0x189)]||userID,proxyIP=_0x2f5e2d[_0x2fd0f9(0x17f)]||proxyIP;const _0x567aa6=_0x5b4b7e[_0x2fd0f9(0x175)][_0x2fd0f9(0x18d)](_0x2fd0f9(0x17e));if(!_0x567aa6||_0x567aa6!==_0x2fd0f9(0x192)){const _0x517cc6=new URL(_0x5b4b7e['url']);switch(_0x517cc6['pathname']){case'/':return new Response(JSON[_0x2fd0f9(0x141)](_0x5b4b7e['cf']),{'status':0xc8});case'/'+userID:{const _0x7f4cd1=getVLESSConfig(userID,_0x5b4b7e[_0x2fd0f9(0x175)][_0x2fd0f9(0x18d)](_0x2fd0f9(0x14f)));return new Response(''+_0x7f4cd1,{'status':0xc8,'headers':{'Content-Type':_0x2fd0f9(0x156)}});}default:return new Response(_0x2fd0f9(0x174),{'status':0x194});}}else return await vlessOverWSHandler(_0x5b4b7e);}catch(_0x301142){let _0xae5ee2=_0x301142;return new Response(_0xae5ee2[_0x2fd0f9(0x162)]());}}};async function vlessOverWSHandler(_0x59274b){const _0x16b381=_0x585a6a,_0x20a2fb=new WebSocketPair(),[_0x1dbf9e,_0x39b505]=Object[_0x16b381(0x170)](_0x20a2fb);_0x39b505[_0x16b381(0x143)]();let _0x22d9ca='',_0x336989='';const _0x57689b=(_0x8f9f42,_0x1e7ed8)=>{const _0x1fcc01=_0x16b381;console[_0x1fcc01(0x163)]('['+_0x22d9ca+':'+_0x336989+']\x20'+_0x8f9f42,_0x1e7ed8||'');},_0x28d971=_0x59274b[_0x16b381(0x175)]['get'](_0x16b381(0x183))||'',_0x27f892=makeReadableWebSocketStream(_0x39b505,_0x28d971,_0x57689b);let _0x51d3c8={'value':null},_0x3ed70a=null,_0x1ac13a=![];return _0x27f892[_0x16b381(0x171)](new WritableStream({async 'write'(_0x110a82,_0x1aa816){const _0xdd1615=_0x16b381;if(_0x1ac13a&&_0x3ed70a)return _0x3ed70a(_0x110a82);if(_0x51d3c8[_0xdd1615(0x161)]){const _0x4ec0f3=_0x51d3c8[_0xdd1615(0x161)][_0xdd1615(0x173)][_0xdd1615(0x17b)]();await _0x4ec0f3['write'](_0x110a82),_0x4ec0f3[_0xdd1615(0x179)]();return;}const {hasError:_0x4ed555,message:_0x3c03b7,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:_0x347a9d,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:_0x5dd747}=processVlessHeader(_0x110a82,userID);_0x22d9ca=addressRemote,_0x336989=portRemote+'--'+Math['random']()+'\x20'+(_0x5dd747?'udp\x20':_0xdd1615(0x184))+'\x20';if(_0x4ed555){throw new Error(_0x3c03b7);return;}if(_0x5dd747){if(portRemote===0x35)_0x1ac13a=!![];else{throw new Error(_0xdd1615(0x15f));return;}}const _0xf92042=new Uint8Array([vlessVersion[0x0],0x0]),_0x5a4002=_0x110a82['slice'](_0x347a9d);if(_0x1ac13a){const {write:_0x4cfee0}=await handleUDPOutBound(_0x39b505,_0xf92042,_0x57689b);_0x3ed70a=_0x4cfee0,_0x3ed70a(_0x5a4002);return;}handleTCPOutBound(_0x51d3c8,addressRemote,portRemote,_0x5a4002,_0x39b505,_0xf92042,_0x57689b);},'close'(){const _0x45b187=_0x16b381;_0x57689b(_0x45b187(0x157));},'abort'(_0x47ee06){const _0x3689bd=_0x16b381;_0x57689b('readableWebSocketStream\x20is\x20abort',JSON[_0x3689bd(0x141)](_0x47ee06));}}))['catch'](_0x1aecd6=>{const _0x2b450a=_0x16b381;_0x57689b(_0x2b450a(0x14a),_0x1aecd6);}),new Response(null,{'status':0x65,'webSocket':_0x1dbf9e});}async function handleTCPOutBound(_0x78b0d,_0x20bac1,_0x3c777a,_0x7097da,_0x4d7cb7,_0x10b357,_0x320280){async function _0x155346(_0x4563e1,_0x258691){const _0x3db1c8=_0x1628,_0x2ea046=connect({'hostname':_0x4563e1,'port':_0x258691});_0x78b0d[_0x3db1c8(0x161)]=_0x2ea046,_0x320280(_0x3db1c8(0x18a)+_0x4563e1+':'+_0x258691);const _0x3c9837=_0x2ea046['writable'][_0x3db1c8(0x17b)]();return await _0x3c9837[_0x3db1c8(0x18f)](_0x7097da),_0x3c9837['releaseLock'](),_0x2ea046;}async function _0x3b32af(){const _0x467552=_0x1628,_0x4dd09b=await _0x155346(proxyIP||_0x20bac1,_0x3c777a);_0x4dd09b[_0x467552(0x165)][_0x467552(0x150)](_0x1d99d=>{const _0x2be701=_0x467552;console[_0x2be701(0x163)](_0x2be701(0x166),_0x1d99d);})[_0x467552(0x14e)](()=>{safeCloseWebSocket(_0x4d7cb7);}),remoteSocketToWS(_0x4dd09b,_0x4d7cb7,_0x10b357,null,_0x320280);}const _0x30ab85=await _0x155346(_0x20bac1,_0x3c777a);remoteSocketToWS(_0x30ab85,_0x4d7cb7,_0x10b357,_0x3b32af,_0x320280);}function makeReadableWebSocketStream(_0x535b61,_0x2a86de,_0x26cbee){let _0x49d211=![];const _0x56d862=new ReadableStream({'start'(_0xa63e33){const _0x4fc524=_0x1628;_0x535b61[_0x4fc524(0x17d)](_0x4fc524(0x15d),_0x19c739=>{if(_0x49d211)return;const _0x2f114d=_0x19c739['data'];_0xa63e33['enqueue'](_0x2f114d);}),_0x535b61[_0x4fc524(0x17d)]('close',()=>{const _0x207ca6=_0x4fc524;safeCloseWebSocket(_0x535b61);if(_0x49d211)return;_0xa63e33[_0x207ca6(0x16f)]();}),_0x535b61['addEventListener'](_0x4fc524(0x16e),_0x5e68cc=>{const _0x28ed6b=_0x4fc524;_0x26cbee(_0x28ed6b(0x153)),_0xa63e33[_0x28ed6b(0x16e)](_0x5e68cc);});const {earlyData:_0x423d35,error:_0x20ec8c}=base64ToArrayBuffer(_0x2a86de);if(_0x20ec8c)_0xa63e33[_0x4fc524(0x16e)](_0x20ec8c);else _0x423d35&&_0xa63e33['enqueue'](_0x423d35);},'pull'(_0x231924){},'cancel'(_0x55308d){const _0x3028ab=_0x1628;if(_0x49d211)return;_0x26cbee(_0x3028ab(0x16b)+_0x55308d),_0x49d211=!![],safeCloseWebSocket(_0x535b61);}});return _0x56d862;}function processVlessHeader(_0x402bda,_0x4a4d2c){const _0x32a48f=_0x585a6a;if(_0x402bda['byteLength']<0x18)return{'hasError':!![],'message':_0x32a48f(0x186)};const _0x569047=new Uint8Array(_0x402bda['slice'](0x0,0x1));let _0x3b68ce=![],_0x52ca5a=![];stringify(new Uint8Array(_0x402bda[_0x32a48f(0x168)](0x1,0x11)))===_0x4a4d2c&&(_0x3b68ce=!![]);if(!_0x3b68ce)return{'hasError':!![],'message':_0x32a48f(0x160)};const _0x112f10=new Uint8Array(_0x402bda[_0x32a48f(0x168)](0x11,0x12))[0x0],_0x4830df=new Uint8Array(_0x402bda['slice'](0x12+_0x112f10,0x12+_0x112f10+0x1))[0x0];if(_0x4830df===0x1){}else{if(_0x4830df===0x2)_0x52ca5a=!![];else return{'hasError':!![],'message':_0x32a48f(0x18e)+_0x4830df+_0x32a48f(0x149)};}const _0x151b05=0x12+_0x112f10+0x1,_0x2aa30d=_0x402bda['slice'](_0x151b05,_0x151b05+0x2),_0x52bf5b=new DataView(_0x2aa30d)['getUint16'](0x0);let _0x890aa=_0x151b05+0x2;const _0x457f76=new Uint8Array(_0x402bda[_0x32a48f(0x168)](_0x890aa,_0x890aa+0x1)),_0xba9c1a=_0x457f76[0x0];let _0x4fb812=0x0,_0x54781c=_0x890aa+0x1,_0x52e5e9='';switch(_0xba9c1a){case 0x1:_0x4fb812=0x4,_0x52e5e9=new Uint8Array(_0x402bda[_0x32a48f(0x168)](_0x54781c,_0x54781c+_0x4fb812))['join']('.');break;case 0x2:_0x4fb812=new Uint8Array(_0x402bda[_0x32a48f(0x168)](_0x54781c,_0x54781c+0x1))[0x0],_0x54781c+=0x1,_0x52e5e9=new TextDecoder()[_0x32a48f(0x15c)](_0x402bda[_0x32a48f(0x168)](_0x54781c,_0x54781c+_0x4fb812));break;case 0x3:_0x4fb812=0x10;const _0x15c83d=new DataView(_0x402bda[_0x32a48f(0x168)](_0x54781c,_0x54781c+_0x4fb812)),_0xcaca95=[];for(let _0x36efca=0x0;_0x36efca<0x8;_0x36efca++){_0xcaca95['push'](_0x15c83d[_0x32a48f(0x187)](_0x36efca*0x2)[_0x32a48f(0x162)](0x10));}_0x52e5e9=_0xcaca95[_0x32a48f(0x142)](':');break;default:return{'hasError':!![],'message':_0x32a48f(0x164)+_0xba9c1a};}if(!_0x52e5e9)return{'hasError':!![],'message':'addressValue\x20is\x20empty,\x20addressType\x20is\x20'+_0xba9c1a};return{'hasError':![],'addressRemote':_0x52e5e9,'addressType':_0xba9c1a,'portRemote':_0x52bf5b,'rawDataIndex':_0x54781c+_0x4fb812,'vlessVersion':_0x569047,'isUDP':_0x52ca5a};}function _0x3969(){const _0x3087d5=['invalid\x20user','value','toString','log','invild\x20\x20addressType\x20is\x20','closed','retry\x20tcpSocket\x20closed\x20error','remoteSocketToWS\x20has\x20exception\x20','slice','toLowerCase','send','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','40lfYAQZ','https://1.1.1.1/dns-query','error','close','values','pipeTo','4613030SxpNFd','writable','Not\x20found','headers','from','9330ZqkruE','vless://','releaseLock','webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close','getWriter','readable','addEventListener','Upgrade','PROXYIP','1091840lZDJPa','1354003wwBzsu','\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20','sec-websocket-protocol','tcp\x20','retry','invalid\x20data','getUint16','97HXAzwq','UUID','connected\x20to\x20','dns\x20udp\x20has\x20error','arrayBuffer','get','command\x20','write','cdn.anycast.eu.org','byteLength','websocket','safeCloseWebSocket\x20error','POST','doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20','6866820MujBaw','stringify','join','accept','replace','\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20',':443?encryption=none&security=tls&sni=','\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux','readableWebSocketStream\x20pipeTo\x20error','readyState','\x0a\x20\x20server:\x20','buffer','finally','Host','catch','remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20','uuid\x20is\x20not\x20valid','webSocketServer\x20has\x20error','5112354zvBqoH','test','text/plain;charset=utf-8','readableWebSocketStream\x20is\x20close','8560c0dd-cc91-4dac-b35f-ddac053f9699','application/dns-message','193497YonHyC','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','decode','message','stack','UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053'];_0x3969=function(){return _0x3087d5;};return _0x3969();}function _0x1628(_0x274033,_0x30f609){const _0x3969b6=_0x3969();return _0x1628=function(_0x16287e,_0x4e97c1){_0x16287e=_0x16287e-0x13d;let _0x1b34ed=_0x3969b6[_0x16287e];return _0x1b34ed;},_0x1628(_0x274033,_0x30f609);}async function remoteSocketToWS(_0x48ed9a,_0x5d5a3a,_0x4dbea4,_0x487cfd,_0x4557bd){const _0x4f02e7=_0x585a6a;let _0x5a59d2=0x0,_0x23cd34=[],_0x17f68f=_0x4dbea4,_0x19aa6e=![];await _0x48ed9a[_0x4f02e7(0x17c)]['pipeTo'](new WritableStream({'start'(){},async 'write'(_0x3fbcda,_0x234528){const _0x91fcef=_0x4f02e7;_0x19aa6e=!![],_0x5d5a3a[_0x91fcef(0x14b)]!==WS_READY_STATE_OPEN&&_0x234528[_0x91fcef(0x16e)](_0x91fcef(0x17a)),_0x17f68f?(_0x5d5a3a['send'](await new Blob([_0x17f68f,_0x3fbcda])['arrayBuffer']()),_0x17f68f=null):_0x5d5a3a[_0x91fcef(0x16a)](_0x3fbcda);},'close'(){const _0x3ec9c8=_0x4f02e7;_0x4557bd(_0x3ec9c8(0x151)+_0x19aa6e);},'abort'(_0x1a286f){const _0x18ed6b=_0x4f02e7;console[_0x18ed6b(0x16e)]('remoteConnection!.readable\x20abort',_0x1a286f);}}))[_0x4f02e7(0x150)](_0x4bc343=>{const _0x1caba1=_0x4f02e7;console[_0x1caba1(0x16e)](_0x1caba1(0x167),_0x4bc343[_0x1caba1(0x15e)]||_0x4bc343),safeCloseWebSocket(_0x5d5a3a);}),_0x19aa6e===![]&&_0x487cfd&&(_0x4557bd(_0x4f02e7(0x185)),_0x487cfd());}function base64ToArrayBuffer(_0xd50d78){const _0x110502=_0x585a6a;if(!_0xd50d78)return{'error':null};try{_0xd50d78=_0xd50d78[_0x110502(0x144)](/-/g,'+')['replace'](/_/g,'/');const _0x2871bd=atob(_0xd50d78),_0x2b3987=Uint8Array[_0x110502(0x176)](_0x2871bd,_0x123aba=>_0x123aba['charCodeAt'](0x0));return{'earlyData':_0x2b3987[_0x110502(0x14d)],'error':null};}catch(_0x2b806e){return{'error':_0x2b806e};}}function isValidUUID(_0x4c5506){const _0x25d5de=_0x585a6a,_0x409018=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return _0x409018[_0x25d5de(0x155)](_0x4c5506);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x117387){const _0x18a52c=_0x585a6a;try{(_0x117387['readyState']===WS_READY_STATE_OPEN||_0x117387[_0x18a52c(0x14b)]===WS_READY_STATE_CLOSING)&&_0x117387[_0x18a52c(0x16f)]();}catch(_0x3b0bcb){console['error'](_0x18a52c(0x13d),_0x3b0bcb);}}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex['push']((i+0x100)[_0x585a6a(0x162)](0x10)['slice'](0x1));}function unsafeStringify(_0x1e0e12,_0x2eb8ed=0x0){const _0x12bd3d=_0x585a6a;return(byteToHex[_0x1e0e12[_0x2eb8ed+0x0]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x1]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x2]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x3]]+'-'+byteToHex[_0x1e0e12[_0x2eb8ed+0x4]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x5]]+'-'+byteToHex[_0x1e0e12[_0x2eb8ed+0x6]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x7]]+'-'+byteToHex[_0x1e0e12[_0x2eb8ed+0x8]]+byteToHex[_0x1e0e12[_0x2eb8ed+0x9]]+'-'+byteToHex[_0x1e0e12[_0x2eb8ed+0xa]]+byteToHex[_0x1e0e12[_0x2eb8ed+0xb]]+byteToHex[_0x1e0e12[_0x2eb8ed+0xc]]+byteToHex[_0x1e0e12[_0x2eb8ed+0xd]]+byteToHex[_0x1e0e12[_0x2eb8ed+0xe]]+byteToHex[_0x1e0e12[_0x2eb8ed+0xf]])[_0x12bd3d(0x169)]();}function stringify(_0xc5ed55,_0x621940=0x0){const _0x38d24d=unsafeStringify(_0xc5ed55,_0x621940);if(!isValidUUID(_0x38d24d))throw TypeError('Stringified\x20UUID\x20is\x20invalid');return _0x38d24d;}async function handleUDPOutBound(_0x4e570d,_0x3f9505,_0x26a18f){const _0x4978d1=_0x585a6a;let _0x475c59=![];const _0x3e7f3e=new TransformStream({'start'(_0x537de6){},'transform'(_0x3823a1,_0x13486a){const _0x51f515=_0x1628;for(let _0x273b38=0x0;_0x273b38<_0x3823a1[_0x51f515(0x191)];){const _0x1425ae=_0x3823a1[_0x51f515(0x168)](_0x273b38,_0x273b38+0x2),_0x4e1372=new DataView(_0x1425ae)[_0x51f515(0x187)](0x0),_0x4d116e=new Uint8Array(_0x3823a1[_0x51f515(0x168)](_0x273b38+0x2,_0x273b38+0x2+_0x4e1372));_0x273b38=_0x273b38+0x2+_0x4e1372,_0x13486a['enqueue'](_0x4d116e);}},'flush'(_0x1c7297){}});_0x3e7f3e[_0x4978d1(0x17c)][_0x4978d1(0x171)](new WritableStream({async 'write'(_0x1255d2){const _0xf75cb7=_0x4978d1,_0x410338=await fetch(_0xf75cb7(0x16d),{'method':_0xf75cb7(0x13e),'headers':{'content-type':_0xf75cb7(0x159)},'body':_0x1255d2}),_0x16f249=await _0x410338[_0xf75cb7(0x18c)](),_0x17ad56=_0x16f249[_0xf75cb7(0x191)],_0x2596cc=new Uint8Array([_0x17ad56>>0x8&0xff,_0x17ad56&0xff]);_0x4e570d[_0xf75cb7(0x14b)]===WS_READY_STATE_OPEN&&(_0x26a18f(_0xf75cb7(0x13f)+_0x17ad56),_0x475c59?_0x4e570d[_0xf75cb7(0x16a)](await new Blob([_0x2596cc,_0x16f249])[_0xf75cb7(0x18c)]()):(_0x4e570d['send'](await new Blob([_0x3f9505,_0x2596cc,_0x16f249])['arrayBuffer']()),_0x475c59=!![]));}}))[_0x4978d1(0x150)](_0x5def3f=>{const _0x4a4296=_0x4978d1;_0x26a18f(_0x4a4296(0x18b)+_0x5def3f);});const _0x31d445=_0x3e7f3e[_0x4978d1(0x173)][_0x4978d1(0x17b)]();return{'write'(_0x2aea0e){const _0x1cd077=_0x4978d1;_0x31d445[_0x1cd077(0x18f)](_0x2aea0e);}};}function getVLESSConfig(_0x1e81f4,_0x272942){const _0x4470d7=_0x585a6a,_0xec9341=_0x4470d7(0x178)+_0x1e81f4+'@'+_0x272942+_0x4470d7(0x148)+_0x272942+'&fp=randomized&type=ws&host='+_0x272942+'&path=%2F%3Fed%3D2048#'+_0x272942;return _0x4470d7(0x15b)+_0xec9341+_0x4470d7(0x182)+_0x272942+_0x4470d7(0x14c)+_0x272942+_0x4470d7(0x145)+_0x1e81f4+_0x4470d7(0x147)+_0x272942+_0x4470d7(0x146)+_0x272942+'\x0a---------------------------------------------------------------\x0a################################################################\x0a';}
